{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport commentApi from \"../api/comment\";\nimport reactionApi from \"../api/reaction\";\nimport { triggerRequireLoginMessage, fetchRatings } from \"../utils/helpers\";\nimport AddCommentModal from \"./AddCommentModal\";\nimport Button from \"./Button\";\nimport CommentModal from \"./CommentsModal\";\nimport CommentOutlinedIcon from \"../icons/CommentOutlinedIcon\";\nimport LikeOutlinedIcon from \"../icons/LikeOutlinedIcon\";\nimport { reviewBlue, ratingsYellow } from \"../styles/colors\";\n\nvar ReviewCard = function ReviewCard(_ref) {\n  var _reaction$like$count, _reaction$like;\n\n  var review = _ref.review,\n      updateReviews = _ref.updateReviews,\n      _ref$showActions = _ref.showActions,\n      showActions = _ref$showActions === void 0 ? true : _ref$showActions;\n  console.log(\"review\", review);\n\n  var _useState = useState(false),\n      isCommentsModalVisible = _useState[0],\n      setCommentsModalVisibility = _useState[1];\n\n  var _useState2 = useState(false),\n      isAddCommentModalVisible = _useState2[0],\n      setAddCommentModalVisibility = _useState2[1];\n\n  var _useState3 = useState([]),\n      comments = _useState3[0],\n      setComments = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      userLikeReactionId = _useState4[0],\n      setUserLikeReactionId = _useState4[1];\n\n  var _useState5 = useState(3),\n      difficulty = _useState5[0],\n      setDifficulty = _useState5[1];\n\n  var _useState6 = useState(3),\n      star = _useState6[0],\n      setStar = _useState6[1];\n\n  var isLoggedIn = useSelector(function (state) {\n    return state.auth.isLoggedIn;\n  });\n  var userId = useSelector(function (state) {\n    var _state$auth$user;\n\n    return (_state$auth$user = state.auth.user) === null || _state$auth$user === void 0 ? void 0 : _state$auth$user._id;\n  });\n  var user = review.user,\n      text = review.text,\n      acadYearTaken = review.acadYearTaken,\n      semesterTaken = review.semesterTaken,\n      reaction = review.reaction,\n      _id = review._id,\n      ratingIds = review.ratingIds;\n  var name = user === null || user === void 0 ? void 0 : user.name;\n  var like = (_reaction$like$count = reaction === null || reaction === void 0 ? void 0 : (_reaction$like = reaction.like) === null || _reaction$like === void 0 ? void 0 : _reaction$like.count) !== null && _reaction$like$count !== void 0 ? _reaction$like$count : 0;\n  useEffect(function () {\n    fetchComments();\n    checkIsLikedByUser();\n  }, []);\n  useEffect(function () {\n    fetchRatings(ratingIds, setStar, setDifficulty);\n  }, [ratingIds]);\n\n  var fetchComments = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var fetchedComments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return commentApi.getCommentsOfReview(_id);\n\n            case 2:\n              fetchedComments = _context.sent;\n              setComments(fetchedComments);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function fetchComments() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var checkIsLikedByUser = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var likeReaction;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return reactionApi.getReaction(\"review\", _id, userId, \"like\");\n\n            case 3:\n              likeReaction = _context2.sent;\n              setUserLikeReactionId(likeReaction._id);\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              setUserLikeReactionId(\"\");\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function checkIsLikedByUser() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onLikeReview = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (isLoggedIn) {\n                _context3.next = 3;\n                break;\n              }\n\n              triggerRequireLoginMessage();\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              if (userLikeReactionId) {\n                _context3.next = 10;\n                break;\n              }\n\n              _context3.next = 6;\n              return reactionApi.addReaction(\"review\", _id, userId, \"like\");\n\n            case 6:\n              updateReviews();\n              checkIsLikedByUser();\n              _context3.next = 14;\n              break;\n\n            case 10:\n              _context3.next = 12;\n              return reactionApi.deleteReaction(userLikeReactionId);\n\n            case 12:\n              updateReviews();\n              checkIsLikedByUser();\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onLikeReview() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var toggleCommentModalVisibility = function toggleCommentModalVisibility() {\n    if (!isLoggedIn) {\n      triggerRequireLoginMessage();\n    } else {\n      setAddCommentModalVisibility(true);\n    }\n  };\n\n  return __jsx(\"div\", {\n    style: styles.container\n  }, __jsx(\"div\", {\n    style: styles.header\n  }, __jsx(\"div\", {\n    style: styles.userInformation\n  }, __jsx(\"span\", null, name), __jsx(\"span\", {\n    style: styles.divider\n  }, \"|\"), __jsx(\"span\", null, \"AY\", acadYearTaken, \", Sem \", semesterTaken), __jsx(\"span\", {\n    style: styles.divider\n  }, \"|\"), __jsx(\"span\", null, \"Difficulty: \", difficulty.toFixed(1)), __jsx(\"span\", {\n    style: styles.divider\n  }, \"|\"), __jsx(\"span\", null, \"Rating: \", star.toFixed(1))), showActions && __jsx(\"div\", {\n    style: styles.actionsBar\n  }, __jsx(\"div\", {\n    style: styles.action\n  }, __jsx(Button, {\n    onClick: onLikeReview\n  }, __jsx(LikeOutlinedIcon, {\n    style: _objectSpread(_objectSpread({}, styles.icon), {}, {\n      color: userLikeReactionId ? ratingsYellow : \"#fff\"\n    })\n  })), __jsx(\"span\", null, \"\".concat(like, \" Likes\"))), __jsx(\"span\", {\n    style: {\n      margin: \"0px 10px\"\n    }\n  }, \"|\"), __jsx(\"div\", {\n    style: styles.action\n  }, __jsx(Button, {\n    onClick: toggleCommentModalVisibility\n  }, __jsx(CommentOutlinedIcon, {\n    style: styles.icon\n  })), __jsx(Button, {\n    onClick: function onClick() {\n      return setCommentsModalVisibility(true);\n    }\n  }, \"\".concat(comments.length, \" Comments\"))))), __jsx(\"div\", {\n    style: styles.review\n  }, text), __jsx(AddCommentModal, {\n    fetchComments: fetchComments,\n    reviewId: _id,\n    isModalVisible: isAddCommentModalVisible,\n    setModalVisibility: setAddCommentModalVisibility\n  }), __jsx(CommentModal, {\n    comments: comments,\n    isModalVisible: isCommentsModalVisible,\n    setModalVisibility: setCommentsModalVisibility\n  }));\n};\n\nvar styles = {\n  container: {\n    padding: 30,\n    backgroundColor: reviewBlue,\n    color: \"#fff\",\n    borderRadius: 15,\n    boxShadow: \"0px 8px 8px rgba(0, 0, 0, 0.25)\",\n    marginBottom: 15,\n    width: \"100%\"\n  },\n  header: {\n    display: \"flex\",\n    justifyContent: \"space-between\"\n  },\n  userInformation: {\n    display: \"flex\",\n    flexWrap: \"wrap\"\n  },\n  actionsBar: {\n    display: \"flex\"\n  },\n  action: {\n    display: \"flex\",\n    justifyContent: \"center\"\n  },\n  icon: {\n    height: 20,\n    marginRight: 10\n  },\n  review: {\n    marginTop: 10,\n    textAlign: \"justify\"\n  },\n  divider: {\n    margin: \"0px 10px\"\n  }\n};\nexport default ReviewCard;","map":null,"metadata":{},"sourceType":"module"}