{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport moduleApi from \"../api/module\";\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport SearchModuleList from \"../components/SearchModuleList\";\nimport SeeMoreButton from \"../components/SeeMoreButton\";\nimport { descriptionGreen } from \"../styles/colors\";\nimport { AutoComplete, Checkbox, InputNumber } from \"antd\";\nvar SEARCH_INTERVAL = 5;\n\nvar Search = function Search(_ref) {\n  var _ref$initialSearchRes = _ref.initialSearchResults,\n      initialSearchResults = _ref$initialSearchRes === void 0 ? [] : _ref$initialSearchRes;\n  var allSchools = useSelector(function (state) {\n    return state.schools;\n  });\n  var schoolOfUser = useSelector(function (state) {\n    return state.auth.user.schoolName;\n  });\n  var schoolsAutocompleteOptions = allSchools.map(function (school) {\n    return {\n      value: school.name\n    };\n  });\n  var searchTerm = useSelector(function (state) {\n    return state.search.searchTerm;\n  });\n\n  var _useState = useState(initialSearchResults),\n      searchResults = _useState[0],\n      setSearchResults = _useState[1];\n\n  var _useState2 = useState(SEARCH_INTERVAL + 1),\n      numberOfResults = _useState2[0],\n      setNumberOfResults = _useState2[1]; // the presence of that n + 1th result is an indicator that there are more than 10 results\n\n\n  var _useState3 = useState(schoolOfUser),\n      schoolFilter = _useState3[0],\n      setSchoolFilter = _useState3[1];\n\n  var _useState4 = useState(schoolsAutocompleteOptions),\n      schoolOptions = _useState4[0],\n      setSchoolOptions = _useState4[1];\n\n  var _useState5 = useState([]),\n      semestersFilter = _useState5[0],\n      setSemestersFilter = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      creditsFilter = _useState6[0],\n      setCreditsFilter = _useState6[1];\n\n  useEffect(function () {\n    setNumberOfResults(SEARCH_INTERVAL + 1);\n  }, [searchTerm, schoolFilter, semestersFilter, creditsFilter]);\n  useEffect(function () {\n    fetchSearchResults();\n  }, [schoolFilter, semestersFilter, creditsFilter]);\n  useEffect(function () {\n    setSchoolFilter(schoolOfUser);\n  }, [schoolOfUser]);\n  useEffect(function () {\n    setSearchResults(initialSearchResults);\n  }, [initialSearchResults]);\n\n  var fetchSearchResults = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _allSchools$find;\n\n      var schoolNameFilter, results;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              schoolNameFilter = (_allSchools$find = allSchools.find(function (school) {\n                return school.name === schoolFilter;\n              })) === null || _allSchools$find === void 0 ? void 0 : _allSchools$find._id;\n              _context.next = 3;\n              return moduleApi.searchModule(searchTerm, numberOfResults, 1, schoolNameFilter, semestersFilter.join(\"_\"), creditsFilter);\n\n            case 3:\n              results = _context.sent;\n              setSearchResults(results);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function fetchSearchResults() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var fetchMoreSearchResults = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var results;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return moduleApi.searchModule(searchTerm, numberOfResults + SEARCH_INTERVAL);\n\n            case 2:\n              results = _context2.sent;\n              console.log(results);\n              setSearchResults(results);\n              setNumberOfResults(numberOfResults + SEARCH_INTERVAL);\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function fetchMoreSearchResults() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var semesterOptions = [{\n    label: 1,\n    value: 1\n  }, {\n    label: 2,\n    value: 2\n  }, {\n    label: 3,\n    value: 3\n  }, {\n    label: 4,\n    value: 4\n  }];\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: styles.header\n  }, __jsx(\"span\", null, \"Search results for \\\"\".concat(searchTerm, \"\\\"\")), __jsx(\"div\", {\n    style: styles.filterBar\n  }, __jsx(\"div\", null, __jsx(\"span\", null, \"School:\"), __jsx(AutoComplete, {\n    style: styles.autocomplete,\n    onSelect: setSchoolFilter,\n    options: schoolOptions,\n    value: schoolFilter,\n    onSearch: function onSearch(searchText) {\n      return setSchoolOptions(schoolsAutocompleteOptions.filter(function (school) {\n        return school.value.toLowerCase().includes(searchText.toLowerCase());\n      }));\n    },\n    onChange: function onChange(value) {\n      return setSchoolFilter(value);\n    },\n    notFoundContent: \"The school you are looking for isn't here. Perhaps you can add them to the app!\"\n  })), __jsx(\"div\", {\n    style: {\n      display: \"flex\"\n    }\n  }, __jsx(\"span\", null, \"Semester:\"), __jsx(\"div\", {\n    style: styles.checkboxes\n  }, __jsx(Checkbox.Group, {\n    options: semesterOptions,\n    onChange: setSemestersFilter,\n    style: {\n      color: \"red\"\n    }\n  }))), __jsx(\"div\", null, __jsx(\"span\", null, \"Credits:\"), __jsx(InputNumber, {\n    max: 12,\n    min: 0,\n    onChange: function onChange(value) {\n      return setCreditsFilter(value);\n    },\n    style: styles.creditsInput\n  })))), __jsx(SearchModuleList, {\n    modules: searchResults.slice(0, numberOfResults - 1)\n  }), searchResults.length == numberOfResults && __jsx(SeeMoreButton, {\n    fetchMoreData: fetchMoreSearchResults,\n    style: {\n      backgroundColor: descriptionGreen\n    }\n  }), __jsx(SectionTitle, {\n    title: \"Similar results to \\\"\".concat(searchTerm, \"\\\"\")\n  }), __jsx(SearchModuleList, {\n    modules: []\n  }), __jsx(ModuleCompareModal, null));\n};\n\nvar styles = {\n  header: {\n    width: \"100%\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    height: \"8vh\",\n    fontSize: \"1.5em\",\n    color: \"#838383\",\n    fontFamily: \"Mukta\",\n    paddingLeft: 20,\n    margin: \"20px 0px\"\n  },\n  filterBar: {\n    display: \"flex\",\n    justifyContent: \"flex-end\",\n    fontSize: 15,\n    alignItems: \"center\"\n  },\n  autocomplete: {\n    width: 300,\n    margin: \"0px 10px\",\n    position: \"relative\" // bottom: 2,\n\n  },\n  checkboxes: {\n    margin: \"0px 10px\",\n    position: \"relative\" // bottom: 2,\n\n  },\n  creditsInput: {\n    marginLeft: 10,\n    position: \"relative\" // bottom: 2,\n\n  }\n};\n\nSearch.getInitialProps = /*#__PURE__*/function () {\n  var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4) {\n    var query, searchTerm, initialSearchResults;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            query = _ref4.query;\n            searchTerm = query.s;\n            _context3.prev = 2;\n            _context3.next = 5;\n            return moduleApi.searchModule(searchTerm, SEARCH_INTERVAL + 1);\n\n          case 5:\n            initialSearchResults = _context3.sent;\n            return _context3.abrupt(\"return\", {\n              initialSearchResults: initialSearchResults\n            });\n\n          case 9:\n            _context3.prev = 9;\n            _context3.t0 = _context3[\"catch\"](2);\n            return _context3.abrupt(\"return\", {\n              initialSearchResults: []\n            });\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[2, 9]]);\n  }));\n\n  return function (_x) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexport default Search;","map":null,"metadata":{},"sourceType":"module"}