{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/zhangxian/Desktop/RottenMods/frontend/pages/search.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport moduleApi from \"../api/module\";\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport SearchModuleList from \"../components/SearchModuleList\";\nimport SeeMoreButton from \"../components/SeeMoreButton\";\nimport { descriptionGreen } from \"../styles/colors\";\nimport { AutoComplete, Checkbox, InputNumber } from \"antd\";\nvar SEARCH_INTERVAL = 5;\n\nvar Search = function Search(_ref) {\n  _s();\n\n  var _ref$initialSearchRes = _ref.initialSearchResults,\n      initialSearchResults = _ref$initialSearchRes === void 0 ? [] : _ref$initialSearchRes;\n  var allSchools = useSelector(function (state) {\n    return state.schools;\n  });\n  var schoolOfUser = useSelector(function (state) {\n    return state.auth.user.schoolName;\n  });\n  var schoolsAutocompleteOptions = allSchools.map(function (school) {\n    return {\n      value: school.name\n    };\n  });\n  var searchTerm = useSelector(function (state) {\n    return state.search.searchTerm;\n  });\n\n  var _useState = useState(initialSearchResults),\n      searchResults = _useState[0],\n      setSearchResults = _useState[1];\n\n  var _useState2 = useState(SEARCH_INTERVAL + 1),\n      numberOfResults = _useState2[0],\n      setNumberOfResults = _useState2[1]; // the presence of that n + 1th result is an indicator that there are more than 10 results\n\n\n  var _useState3 = useState(schoolOfUser),\n      schoolFilter = _useState3[0],\n      setSchoolFilter = _useState3[1];\n\n  var _useState4 = useState(schoolsAutocompleteOptions),\n      schoolOptions = _useState4[0],\n      setSchoolOptions = _useState4[1];\n\n  var _useState5 = useState([]),\n      semestersFilter = _useState5[0],\n      setSemestersFilter = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      creditsFilter = _useState6[0],\n      setCreditsFilter = _useState6[1];\n\n  useEffect(function () {\n    setNumberOfResults(SEARCH_INTERVAL + 1);\n  }, [searchTerm, schoolFilter, semestersFilter, creditsFilter]);\n  useEffect(function () {\n    fetchSearchResults();\n  }, [schoolFilter, semestersFilter, creditsFilter]);\n  useEffect(function () {\n    setSchoolFilter(schoolOfUser);\n  }, [schoolOfUser]);\n  useEffect(function () {\n    setSearchResults(initialSearchResults);\n  }, [initialSearchResults]);\n\n  var fetchSearchResults = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _allSchools$find;\n\n      var schoolNameFilter, results;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              schoolNameFilter = (_allSchools$find = allSchools.find(function (school) {\n                return school.name === schoolFilter;\n              })) === null || _allSchools$find === void 0 ? void 0 : _allSchools$find._id;\n              _context.next = 3;\n              return moduleApi.searchModule(searchTerm, numberOfResults, 1, schoolNameFilter, semestersFilter.join(\"_\"), creditsFilter);\n\n            case 3:\n              results = _context.sent;\n              setSearchResults(results);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function fetchSearchResults() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var fetchMoreSearchResults = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var results;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return moduleApi.searchModule(searchTerm, numberOfResults + SEARCH_INTERVAL);\n\n            case 2:\n              results = _context2.sent;\n              console.log(results);\n              setSearchResults(results);\n              setNumberOfResults(numberOfResults + SEARCH_INTERVAL);\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function fetchMoreSearchResults() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var semesterOptions = [{\n    label: 1,\n    value: 1\n  }, {\n    label: 2,\n    value: 2\n  }, {\n    label: 3,\n    value: 3\n  }];\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: styles.header,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }\n  }, \"Search results for \\\"\".concat(searchTerm, \"\\\"\")), __jsx(\"div\", {\n    style: styles.filterBar,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 11\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  }, \"School:\"), __jsx(AutoComplete, {\n    style: styles.autocomplete,\n    onSelect: setSchoolFilter,\n    options: schoolOptions,\n    value: schoolFilter,\n    onSearch: function onSearch(searchText) {\n      return setSchoolOptions(schoolsAutocompleteOptions.filter(function (school) {\n        return school.value.toLowerCase().includes(searchText.toLowerCase());\n      }));\n    },\n    onChange: function onChange(value) {\n      return setSchoolFilter(value);\n    },\n    notFoundContent: \"The school you are looking for isn't here. Perhaps you can add them to the app!\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  })), __jsx(\"div\", {\n    style: {\n      display: \"flex\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 11\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }\n  }, \"Semester:\"), __jsx(\"div\", {\n    style: styles.checkboxes,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }\n  }, __jsx(Checkbox.Group, {\n    options: semesterOptions,\n    onChange: setSemestersFilter,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 15\n    }\n  }))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 11\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 13\n    }\n  }, \"Credits:\"), __jsx(InputNumber, {\n    max: 12,\n    onChange: function onChange(value) {\n      return setCreditsFilter(value);\n    },\n    style: styles.creditsInput,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 13\n    }\n  })))), __jsx(SearchModuleList, {\n    modules: searchResults.slice(0, numberOfResults - 1),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }\n  }), searchResults.length == numberOfResults && __jsx(SeeMoreButton, {\n    fetchMoreData: fetchMoreSearchResults,\n    style: {\n      backgroundColor: descriptionGreen\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  }), __jsx(SectionTitle, {\n    title: \"Similar results to \\\"\".concat(searchTerm, \"\\\"\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }\n  }), __jsx(SearchModuleList, {\n    modules: [],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }), __jsx(ModuleCompareModal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }\n  }));\n};\n\n_s(Search, \"LPXwd5I488sFe7lc17ZclugG610=\", false, function () {\n  return [useSelector, useSelector, useSelector];\n});\n\n_c = Search;\nvar styles = {\n  header: {\n    width: \"100%\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    height: \"8vh\",\n    fontSize: \"1.5em\",\n    color: \"#838383\",\n    fontFamily: \"Mukta\",\n    paddingLeft: 20,\n    margin: \"20px 0px\"\n  },\n  filterBar: {\n    display: \"flex\",\n    justifyContent: \"flex-end\",\n    fontSize: 15,\n    alignItems: \"center\"\n  },\n  autocomplete: {\n    width: 300,\n    margin: \"0px 10px\",\n    position: \"relative\" // bottom: 2,\n\n  },\n  checkboxes: {\n    margin: \"0px 10px\",\n    position: \"relative\" // bottom: 2,\n\n  },\n  creditsInput: {\n    marginLeft: 10,\n    position: \"relative\" // bottom: 2,\n\n  }\n};\n\nSearch.getInitialProps = /*#__PURE__*/function () {\n  var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4) {\n    var query, searchTerm, initialSearchResults;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            query = _ref4.query;\n            searchTerm = query.s;\n            _context3.prev = 2;\n            _context3.next = 5;\n            return moduleApi.searchModule(searchTerm, SEARCH_INTERVAL + 1);\n\n          case 5:\n            initialSearchResults = _context3.sent;\n            return _context3.abrupt(\"return\", {\n              initialSearchResults: initialSearchResults\n            });\n\n          case 9:\n            _context3.prev = 9;\n            _context3.t0 = _context3[\"catch\"](2);\n            return _context3.abrupt(\"return\", {\n              initialSearchResults: []\n            });\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[2, 9]]);\n  }));\n\n  return function (_x) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexport default Search;\n\nvar _c;\n\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"sources":["/Users/zhangxian/Desktop/RottenMods/frontend/pages/search.tsx"],"names":["useState","useEffect","useSelector","moduleApi","ModuleCompareModal","SectionTitle","SearchModuleList","SeeMoreButton","descriptionGreen","AutoComplete","Checkbox","InputNumber","SEARCH_INTERVAL","Search","initialSearchResults","allSchools","state","schools","schoolOfUser","auth","user","schoolName","schoolsAutocompleteOptions","map","school","value","name","searchTerm","search","searchResults","setSearchResults","numberOfResults","setNumberOfResults","schoolFilter","setSchoolFilter","schoolOptions","setSchoolOptions","semestersFilter","setSemestersFilter","creditsFilter","setCreditsFilter","fetchSearchResults","schoolNameFilter","find","_id","searchModule","join","results","fetchMoreSearchResults","console","log","semesterOptions","label","styles","header","filterBar","autocomplete","searchText","filter","toLowerCase","includes","display","checkboxes","creditsInput","slice","length","backgroundColor","width","justifyContent","alignItems","height","fontSize","color","fontFamily","paddingLeft","margin","position","marginLeft","getInitialProps","query","s"],"mappings":"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","sourcesContent":["import { NextPage } from \"next\";\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport moduleApi from \"../api/module\";\nimport { Module } from \"../types\";\n\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport SearchModuleList from \"../components/SearchModuleList\";\nimport SeeMoreButton from \"../components/SeeMoreButton\";\nimport { descriptionGreen } from \"../styles/colors\";\nimport { AutoComplete, Checkbox, InputNumber } from \"antd\";\n\ninterface SearchProps {\n  initialSearchResults: Module[];\n}\n\nconst SEARCH_INTERVAL = 5;\n\nconst Search: NextPage<SearchProps> = ({ initialSearchResults = [] }) => {\n  const allSchools = useSelector((state) => state.schools);\n  const schoolOfUser = useSelector((state) => state.auth.user.schoolName);\n  const schoolsAutocompleteOptions = allSchools.map((school) => ({\n    value: school.name,\n  }));\n  const searchTerm = useSelector((state) => state.search.searchTerm);\n\n  const [searchResults, setSearchResults] = useState(initialSearchResults);\n  const [numberOfResults, setNumberOfResults] = useState(SEARCH_INTERVAL + 1); // the presence of that n + 1th result is an indicator that there are more than 10 results\n  const [schoolFilter, setSchoolFilter] = useState(schoolOfUser);\n  const [schoolOptions, setSchoolOptions] = useState(\n    schoolsAutocompleteOptions\n  );\n  const [semestersFilter, setSemestersFilter] = useState([]);\n  const [creditsFilter, setCreditsFilter] = useState(\"\");\n\n  useEffect(() => {\n    setNumberOfResults(SEARCH_INTERVAL + 1);\n  }, [searchTerm, schoolFilter, semestersFilter, creditsFilter]);\n\n  useEffect(() => {\n    fetchSearchResults();\n  }, [schoolFilter, semestersFilter, creditsFilter]);\n\n  useEffect(() => {\n    setSchoolFilter(schoolOfUser);\n  }, [schoolOfUser]);\n\n  useEffect(() => {\n    setSearchResults(initialSearchResults);\n  }, [initialSearchResults]);\n\n  const fetchSearchResults = async () => {\n    const schoolNameFilter = allSchools.find(\n      (school) => school.name === schoolFilter\n    )?._id;\n    const results = await moduleApi.searchModule(\n      searchTerm,\n      numberOfResults,\n      1,\n      schoolNameFilter,\n      semestersFilter.join(\"_\"),\n      creditsFilter\n    );\n    setSearchResults(results);\n  };\n\n  const fetchMoreSearchResults = async () => {\n    const results = await moduleApi.searchModule(\n      searchTerm,\n      numberOfResults + SEARCH_INTERVAL\n    );\n    console.log(results);\n    setSearchResults(results);\n    setNumberOfResults(numberOfResults + SEARCH_INTERVAL);\n  };\n\n  const semesterOptions = [\n    {\n      label: 1,\n      value: 1,\n    },\n    {\n      label: 2,\n      value: 2,\n    },\n    {\n      label: 3,\n      value: 3,\n    },\n  ];\n\n  return (\n    <>\n      <div style={styles.header}>\n        <span>{`Search results for \"${searchTerm}\"`}</span>\n        <div style={styles.filterBar}>\n          <div>\n            <span>School:</span>\n            <AutoComplete\n              style={styles.autocomplete}\n              onSelect={setSchoolFilter}\n              options={schoolOptions}\n              value={schoolFilter}\n              onSearch={(searchText) =>\n                setSchoolOptions(\n                  schoolsAutocompleteOptions.filter((school) =>\n                    school.value\n                      .toLowerCase()\n                      .includes(searchText.toLowerCase())\n                  )\n                )\n              }\n              onChange={(value) => setSchoolFilter(value)}\n              notFoundContent={\n                \"The school you are looking for isn't here. Perhaps you can add them to the app!\"\n              }\n            />\n          </div>\n          <div style={{ display: \"flex\" }}>\n            <span>Semester:</span>\n            <div style={styles.checkboxes}>\n              <Checkbox.Group\n                options={semesterOptions}\n                onChange={setSemestersFilter}\n              />\n            </div>\n          </div>\n          <div>\n            <span>Credits:</span>\n            <InputNumber\n              max={12}\n              onChange={(value) => setCreditsFilter(value as string)}\n              style={styles.creditsInput}\n            />\n          </div>\n        </div>\n      </div>\n      <SearchModuleList modules={searchResults.slice(0, numberOfResults - 1)} />\n      {searchResults.length == numberOfResults && (\n        <SeeMoreButton\n          fetchMoreData={fetchMoreSearchResults}\n          style={{ backgroundColor: descriptionGreen }}\n        />\n      )}\n\n      <SectionTitle title={`Similar results to \"${searchTerm}\"`} />\n      <SearchModuleList modules={[]} />\n      <ModuleCompareModal />\n    </>\n  );\n};\n\nconst styles = {\n  header: {\n    width: \"100%\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    height: \"8vh\",\n    fontSize: \"1.5em\",\n    color: \"#838383\",\n    fontFamily: \"Mukta\",\n    paddingLeft: 20,\n    margin: \"20px 0px\",\n  },\n  filterBar: {\n    display: \"flex\",\n    justifyContent: \"flex-end\",\n    fontSize: 15,\n    alignItems: \"center\",\n  },\n  autocomplete: {\n    width: 300,\n    margin: \"0px 10px\",\n    position: \"relative\" as \"relative\",\n    // bottom: 2,\n  },\n  checkboxes: {\n    margin: \"0px 10px\",\n    position: \"relative\" as \"relative\",\n    // bottom: 2,\n  },\n  creditsInput: {\n    marginLeft: 10,\n    position: \"relative\" as \"relative\",\n    // bottom: 2,\n  },\n};\n\nSearch.getInitialProps = async ({ query }) => {\n  const searchTerm = query.s;\n  try {\n    const initialSearchResults = await moduleApi.searchModule(\n      searchTerm,\n      SEARCH_INTERVAL + 1\n    );\n    return { initialSearchResults };\n  } catch (err) {\n    return { initialSearchResults: [] };\n  }\n};\n\nexport default Search;\n"]},"metadata":{},"sourceType":"module"}