{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { logInAction, logOutAction } from './../redux/actions/auth';\nimport authApi from \"../api/auth\";\nimport courseApi from \"../api/course\";\nimport schoolApi from \"../api/school\";\nimport { store } from \"../redux/store\";\nimport { message } from \"antd\";\n\nfunction signUp(_x) {\n  return _signUp.apply(this, arguments);\n}\n\nfunction _signUp() {\n  _signUp = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n    var fullname, emailaddress, userpassword, university, course, yearofstudy, data;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            fullname = values.fullname, emailaddress = values.emailaddress, userpassword = values.userpassword, university = values.university, course = values.course, yearofstudy = values.yearofstudy; // let createUserConfig = {\n            //     method: 'post',\n            //     url: 'http://localhost:8080/api/user',\n            //     headers: {\n            //         'Content-Type': 'application/json'\n            //     },\n            //     data: {\n            //         \"name\": values.fullname,\n            //         \"email\": values.emailaddress,\n            //         \"password\": values.userpassword,\n            //         \"schoolId\": values.university,\n            //         \"courseId\": values.course,\n            //         \"currentYear\": values.yearofstudy\n            //     }\n            // };\n            // let createSchoolConfig = {\n            //     method: 'post',\n            //     url: 'http://localhost:8080/api/school',\n            //     headers: {\n            //         'Content-Type': 'application/json'\n            //     },\n            //     data: {\n            //         \"name\": values.fullname,\n            //     }\n            // };\n            // let createCourseConfig = {\n            //     method: 'post',\n            //     url: 'http://localhost:8080/api/course',\n            //     headers: {\n            //         'Content-Type': 'application/json'\n            //     },\n            //     data: {\n            //         \"name\": values.fullname,\n            //     }\n            // };\n            // if schoolId is user created, then create a new school in the system\n\n            if (!(course !== \"userCreated\" && university !== \"userCreated\")) {\n              _context.next = 6;\n              break;\n            }\n\n            _context.next = 4;\n            return authApi.signUp(fullname, emailaddress, userpassword)[\"catch\"](function (error) {\n              throw error;\n            });\n\n          case 4:\n            data = _context.sent;\n\n            if (data) {\n              console.log(\"sign up success\");\n            }\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _signUp.apply(this, arguments);\n}\n\nfunction logIn(_x2) {\n  return _logIn.apply(this, arguments);\n}\n\nfunction _logIn() {\n  _logIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values) {\n    var emailaddress, password, data, name, currentYear, courseId, _id, schoolId, userPassword, courseData, schoolData, user;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log(\"attempting login with\");\n            console.log(values);\n            emailaddress = values.emailaddress, password = values.password;\n            _context2.next = 5;\n            return authApi.logIn(emailaddress, password)[\"catch\"](function (error) {\n              throw error;\n            });\n\n          case 5:\n            data = _context2.sent;\n\n            if (!data) {\n              _context2.next = 22;\n              break;\n            }\n\n            name = data.name, currentYear = data.currentYear, courseId = data.courseId, _id = data._id, schoolId = data.schoolId, userPassword = data.userPassword;\n            courseData = null;\n            schoolData = null;\n\n            if (!courseId) {\n              _context2.next = 14;\n              break;\n            }\n\n            _context2.next = 13;\n            return courseApi.getCourse(courseId);\n\n          case 13:\n            courseData = _context2.sent;\n\n          case 14:\n            if (!schoolId) {\n              _context2.next = 18;\n              break;\n            }\n\n            _context2.next = 17;\n            return schoolApi.getSchool(schoolId);\n\n          case 17:\n            schoolData = _context2.sent;\n\n          case 18:\n            user = {\n              fullName: name,\n              email: emailaddress,\n              password: userPassword,\n              yearOfStudy: currentYear ? currentYear : null,\n              courseName: courseData ? courseData.name : null,\n              schoolName: schoolData ? schoolData.name : null,\n              _id: _id\n            };\n            window.localStorage.setItem(\"ROTTENMODS_EMAIL\", emailaddress);\n            window.localStorage.setItem(\"ROTTENMODS_PASSWORD\", password);\n            store.dispatch(logInAction(user));\n\n          case 22:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _logIn.apply(this, arguments);\n}\n\nfunction logOut() {\n  return _logOut.apply(this, arguments);\n}\n\nfunction _logOut() {\n  _logOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return authApi.logOut()[\"catch\"](function (error) {\n              throw error;\n            });\n\n          case 2:\n            response = _context3.sent;\n            window.localStorage.removeItem(\"ROTTENMODS_EMAIL\");\n            window.localStorage.removeItem(\"ROTTENMODS_PASSWORD\");\n            message.success(\"Successfully Logged Out!\");\n            store.dispatch(logOutAction());\n\n          case 7:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _logOut.apply(this, arguments);\n}\n\n;\nexport default {\n  signUp: signUp,\n  logIn: logIn,\n  logOut: logOut\n};","map":{"version":3,"sources":["/Users/zhangxian/Desktop/RottenMods/frontend/utils/authentication.ts"],"names":["logInAction","logOutAction","authApi","courseApi","schoolApi","store","message","signUp","values","fullname","emailaddress","userpassword","university","course","yearofstudy","error","data","console","log","logIn","password","name","currentYear","courseId","_id","schoolId","userPassword","courseData","schoolData","getCourse","getSchool","user","fullName","email","yearOfStudy","courseName","schoolName","window","localStorage","setItem","dispatch","logOut","response","removeItem","success"],"mappings":"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","sourcesContent":["import { logInAction, logOutAction } from './../redux/actions/auth';\nimport axios from \"axios\";\nimport { LOG_USER_IN, LOG_USER_OUT } from \"../redux/constants\";\nimport { User } from \"../types\";\nimport authApi from \"../api/auth\";\nimport courseApi from \"../api/course\";\nimport schoolApi from \"../api/school\";\n\nimport { store } from \"../redux/store\";\n\nimport { message } from \"antd\";\n\nasync function signUp(values) {\n  const {\n    fullname,\n    emailaddress,\n    userpassword,\n    university,\n    course,\n    yearofstudy,\n  } = values;\n\n  // let createUserConfig = {\n  //     method: 'post',\n  //     url: 'http://localhost:8080/api/user',\n  //     headers: {\n  //         'Content-Type': 'application/json'\n  //     },\n  //     data: {\n  //         \"name\": values.fullname,\n  //         \"email\": values.emailaddress,\n  //         \"password\": values.userpassword,\n  //         \"schoolId\": values.university,\n  //         \"courseId\": values.course,\n  //         \"currentYear\": values.yearofstudy\n  //     }\n  // };\n\n  // let createSchoolConfig = {\n  //     method: 'post',\n  //     url: 'http://localhost:8080/api/school',\n  //     headers: {\n  //         'Content-Type': 'application/json'\n  //     },\n  //     data: {\n  //         \"name\": values.fullname,\n  //     }\n  // };\n\n  // let createCourseConfig = {\n  //     method: 'post',\n  //     url: 'http://localhost:8080/api/course',\n  //     headers: {\n  //         'Content-Type': 'application/json'\n  //     },\n  //     data: {\n  //         \"name\": values.fullname,\n  //     }\n  // };\n\n  // if schoolId is user created, then create a new school in the system\n\n  if (course !== \"userCreated\" && university !== \"userCreated\") {\n    const data = await authApi\n      .signUp(\n        fullname,\n        emailaddress,\n        userpassword,\n      )\n      .catch((error) => {\n        throw error;\n      });\n    if (data) {\n      console.log(\"sign up success\");\n    }\n  }\n}\n\nasync function logIn(values) {\n  console.log(\"attempting login with\");\n  console.log(values);\n  const { emailaddress, password } = values;\n  const data = await authApi.logIn(emailaddress, password).catch((error) => {\n    throw error;\n  });\n  if (data) {\n    const { name, currentYear, courseId, _id, schoolId, userPassword} = data;\n    let courseData = null;\n    let schoolData = null;\n    if (courseId) {\n      courseData = await courseApi.getCourse(courseId);\n    }\n    if (schoolId) {\n      schoolData = await schoolApi.getSchool(schoolId);\n    }     \n    const user: User = {\n      fullName: name,\n      email: emailaddress,\n      password: userPassword,\n      yearOfStudy: currentYear ? currentYear : null,\n      courseName: courseData ? courseData.name : null,\n      schoolName: schoolData ? schoolData.name : null,\n      _id,\n    };\n\n    window.localStorage.setItem(\"ROTTENMODS_EMAIL\", emailaddress);\n    window.localStorage.setItem(\"ROTTENMODS_PASSWORD\", password);\n\n    store.dispatch(logInAction(user));\n  }\n}\n\nasync function logOut() {\n  const response = await authApi.logOut().catch((error) => {\n    throw error;\n  });\n\n    window.localStorage.removeItem(\"ROTTENMODS_EMAIL\");\n    window.localStorage.removeItem(\"ROTTENMODS_PASSWORD\");\n\n    message.success(\"Successfully Logged Out!\");\n\n    store.dispatch(logOutAction());\n\n  \n\n};\n\nexport default {\n  signUp,\n  logIn,\n  logOut,\n};\n"]},"metadata":{},"sourceType":"module"}