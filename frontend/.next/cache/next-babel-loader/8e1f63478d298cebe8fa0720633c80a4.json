{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/zhangxian/Desktop/RottenMods/frontend/pages/module-review.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport moduleApi from \"../api/module\";\nimport reviewApi from \"../api/review\";\nimport eventApi from \"../api/event\";\nimport AddReviewModal from \"../components/AddReviewModal\";\nimport AddRatingsModal from \"../components/AddRatingsModal\";\nimport { Dropdown, Menu } from \"antd\";\nimport { DownOutlined } from \"@ant-design/icons\";\nimport ModuleInformation from \"../components/ModuleInformation\";\nimport ReviewList from \"../components/ReviewList\";\n\nvar ModuleReviewPage = function ModuleReviewPage(_ref) {\n  _s();\n\n  var module = _ref.module,\n      reviews = _ref.reviews;\n\n  var _useState = useState(reviews),\n      reviewsList = _useState[0],\n      setReviewsList = _useState[1];\n\n  var _useState2 = useState(false),\n      isAddReviewModalVisible = _useState2[0],\n      setAddReviewModalVisibility = _useState2[1];\n\n  var _useState3 = useState(false),\n      isAddRatingsModalVisible = _useState3[0],\n      setAddRatingsModalVisibility = _useState3[1];\n\n  var _useState4 = useState(null),\n      ratingByUser = _useState4[0],\n      setRatingByUser = _useState4[1];\n\n  var userId = useSelector(function (state) {\n    var _state$auth$user;\n\n    return (_state$auth$user = state.auth.user) === null || _state$auth$user === void 0 ? void 0 : _state$auth$user._id;\n  });\n  var reviewByUser = reviewsList.find(function (review) {\n    return review.userId === userId;\n  }); // Analytics\n\n  useEffect(function () {\n    checkIsRatedByUser();\n    eventApi.addEvent(userId, \"mod\", module._id, \"view\");\n  }, []);\n\n  var updateReviews = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var newReviews;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return reviewApi.getReviewsOfModule(module._id);\n\n            case 2:\n              newReviews = _context.sent;\n              setReviewsList(newReviews);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function updateReviews() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var checkIsRatedByUser = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var rating;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return reviewApi.getRating(\"mod\", userId, \"star\");\n\n            case 3:\n              rating = _context2.sent;\n              setRatingByUser(rating);\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              setRatingByUser(null);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function checkIsRatedByUser() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var menu = __jsx(Menu, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 5\n    }\n  }, __jsx(Menu.Item, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }\n  }, \"Newest\"), __jsx(Menu.Item, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }\n  }, \"Oldest\"), __jsx(Menu.Item, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }\n  }, \"Most Likes\"), __jsx(Menu.Item, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 7\n    }\n  }, \"Most Comments\"));\n\n  var renderPage = function renderPage() {\n    return module ? __jsx(React.Fragment, null, __jsx(ModuleInformation, {\n      module: module,\n      setAddReviewModalVisibility: setAddReviewModalVisibility,\n      setAddRatingsModalVisibility: setAddRatingsModalVisibility,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }\n    }), __jsx(\"div\", {\n      style: styles.reviewsHeader,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }\n    }, __jsx(\"span\", {\n      style: styles.reviewsHeaderTitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }\n    }, \"Reviews\"), __jsx(Dropdown, {\n      overlay: menu,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 11\n      }\n    }, __jsx(\"div\", {\n      style: {\n        marginRight: 20\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 13\n      }\n    }, __jsx(\"a\", {\n      style: {\n        color: \"#595959\",\n        marginRight: 6,\n        fontSize: 18\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 15\n      }\n    }, \"Sort\"), __jsx(DownOutlined, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 15\n      }\n    })))), __jsx(ReviewList, {\n      updateReviews: updateReviews,\n      reviews: reviewsList,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }\n    }), __jsx(AddReviewModal, {\n      code: module.code,\n      modId: module._id,\n      updateReviews: updateReviews,\n      isModalVisible: isAddReviewModalVisible,\n      setModalVisibility: setAddReviewModalVisibility,\n      reviewByUser: reviewByUser,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }\n    }), __jsx(AddRatingsModal, {\n      code: module.code,\n      modId: module._id,\n      isModalVisible: isAddRatingsModalVisible,\n      setModalVisibility: setAddRatingsModalVisibility,\n      ratingsByUser: ratingByUser,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }\n    })) : __jsx(\"div\", {\n      style: styles.moduleNotFoundPage,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }\n    }, __jsx(\"span\", {\n      style: {},\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }\n    }, \"Module not found!\"));\n  };\n\n  return renderPage();\n};\n\n_s(ModuleReviewPage, \"b+95JMorfxdCyavDHXShhhWyQSY=\", false, function () {\n  return [useSelector];\n});\n\n_c = ModuleReviewPage;\nvar styles = {\n  reviewsHeader: {\n    height: \"8vh\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    padding: \"0px 10px\",\n    fontFamily: \"Mukta\",\n    color: \"#838383\"\n  },\n  reviewsHeaderTitle: {\n    fontSize: \"26px\"\n  },\n  moduleNotFoundPage: {\n    display: \"flex\",\n    height: \"80vh\",\n    width: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  }\n};\n\nModuleReviewPage.getInitialProps = /*#__PURE__*/function () {\n  var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref4) {\n    var query, moduleId, module, prereqs, reviews;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            query = _ref4.query;\n            moduleId = query.id;\n            _context4.prev = 2;\n            _context4.next = 5;\n            return moduleApi.getModule(moduleId);\n\n          case 5:\n            module = _context4.sent;\n            _context4.next = 8;\n            return Promise.all(module.prereqs.map( /*#__PURE__*/function () {\n              var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(prereqId) {\n                var mod;\n                return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        _context3.next = 2;\n                        return moduleApi.getModule(prereqId);\n\n                      case 2:\n                        mod = _context3.sent;\n                        return _context3.abrupt(\"return\", mod.code);\n\n                      case 4:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function (_x2) {\n                return _ref6.apply(this, arguments);\n              };\n            }()));\n\n          case 8:\n            prereqs = _context4.sent;\n            module.prereqs = prereqs;\n            _context4.next = 12;\n            return reviewApi.getReviewsOfModule(module._id);\n\n          case 12:\n            reviews = _context4.sent;\n            return _context4.abrupt(\"return\", {\n              module: module,\n              reviews: reviews\n            });\n\n          case 16:\n            _context4.prev = 16;\n            _context4.t0 = _context4[\"catch\"](2);\n            return _context4.abrupt(\"return\", {\n              module: null,\n              reviews: []\n            });\n\n          case 19:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, null, [[2, 16]]);\n  }));\n\n  return function (_x) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexport default ModuleReviewPage; // const dummyReviews: Review[] = [\n//   {\n//     userName: \"Thomas Tan\",\n//     likes: 79,\n//     text: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer eget bibendum purus, sed ultricies nunc. Proin et purus odio. Etiam ex elit, consectetur placerat feugiat non, luctus eu justo. Vestibulum quis accumsan orci. Morbi ante massa, semper in mi eleifend, tempor posuere quam. In odio nulla, tristique et lorem vitae, mollis dictum ipsum. Sed sollicitudin augue quis turpis hendrerit laoreet. Nam facilisis turpis leo, in lobortis lorem lobortis vel. Maecenas scelerisque ante vel elit lobortis lobortis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nulla ac imperdiet erat. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Mauris eu purus at urna facilisis eleifend. Ut dapibus, ex vitae vehicula suscipit, enim lacus vulputate tortor, vel convallis diam dui quis est. Duis cursus velit enim, vitae interdum nisi facilisis ut. In porttitor lacus vulputate lacinia semper. Vivamus consectetur felis vitae felis maximus sodales. Sed scelerisque blandit consectetur. Duis nec dictum ligula, quis lobortis ipsum. Ut rhoncus, nulla quis cursus euismod, quam metus pellentesque nulla, sit amet gravida felis libero id urna. Aenean a nunc imperdiet, vestibulum nibh nec, pretium tortor. Mauris magna nisl, porta eget orci eu, sodales gravida nulla. Sed eleifend dapibus libero quis fermentum. Vivamus non hendrerit augue.\",\n//     yearTaken: 2020,\n//     semesterTaken: 1,\n//     workload: 10,\n//     rating: {\n//       difficulty: 5,\n//       star: 5\n//     },\n//     _id: \"1\"\n//   },\n//   {\n//     userName: \"Susan Lim\",\n//     likes: 24,\n//     text: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer eget bibendum purus, sed ultricies nunc. Proin et purus odio. Etiam ex elit, consectetur placerat feugiat non, luctus eu justo. Vestibulum quis accumsan orci. Morbi ante massa, semper in mi eleifend, tempor posuere quam. In odio nulla, tristique et lorem vitae, mollis dictum ipsum. Sed sollicitudin augue quis turpis hendrerit laoreet. Nam facilisis turpis leo, in lobortis lorem lobortis vel. Maecenas scelerisque ante vel elit lobortis lobortis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.\",\n//     yearTaken: 2020,\n//     semesterTaken: 1,\n//     workload: 10,\n//     rating: {\n//       difficulty: 5,\n//       star: 5\n//     },\n//     _id: \"2\"\n//   }\n// ]\n\nvar _c;\n\n$RefreshReg$(_c, \"ModuleReviewPage\");","map":{"version":3,"sources":["/Users/zhangxian/Desktop/RottenMods/frontend/pages/module-review.tsx"],"names":["useState","useEffect","useSelector","moduleApi","reviewApi","eventApi","AddReviewModal","AddRatingsModal","Dropdown","Menu","DownOutlined","ModuleInformation","ReviewList","ModuleReviewPage","module","reviews","reviewsList","setReviewsList","isAddReviewModalVisible","setAddReviewModalVisibility","isAddRatingsModalVisible","setAddRatingsModalVisibility","ratingByUser","setRatingByUser","userId","state","auth","user","_id","reviewByUser","find","review","checkIsRatedByUser","addEvent","updateReviews","getReviewsOfModule","newReviews","getRating","rating","menu","renderPage","styles","reviewsHeader","reviewsHeaderTitle","marginRight","color","fontSize","code","moduleNotFoundPage","height","display","justifyContent","alignItems","padding","fontFamily","width","getInitialProps","query","moduleId","id","getModule","Promise","all","prereqs","map","prereqId","mod"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { NextPage } from \"next\";\nimport { Module, Review } from \"../types\";\nimport moduleApi from \"../api/module\";\nimport reviewApi from \"../api/review\";\nimport eventApi from \"../api/event\";\n\nimport AddReviewModal from \"../components/AddReviewModal\";\nimport AddRatingsModal from \"../components/AddRatingsModal\";\nimport { Dropdown, Menu } from \"antd\";\nimport { DownOutlined } from \"@ant-design/icons\";\nimport ModuleInformation from \"../components/ModuleInformation\";\nimport ReviewList from \"../components/ReviewList\";\n\ninterface ModuleReviewProps {\n  module: Module;\n  reviews: Review[];\n}\n\nconst ModuleReviewPage: NextPage<ModuleReviewProps> = ({ module, reviews }) => {\n  const [reviewsList, setReviewsList] = useState(reviews);\n  const [isAddReviewModalVisible, setAddReviewModalVisibility] = useState(\n    false\n  );\n  const [isAddRatingsModalVisible, setAddRatingsModalVisibility] = useState(\n    false\n  );\n  const [ratingByUser, setRatingByUser] = useState(null);\n  const userId = useSelector((state) => state.auth.user?._id);\n  const reviewByUser = reviewsList.find((review) => review.userId === userId);\n\n  // Analytics\n  useEffect(() => {\n    checkIsRatedByUser();\n    eventApi.addEvent(userId, \"mod\", module._id, \"view\");\n  }, []);\n\n  const updateReviews = async () => {\n    const newReviews = await reviewApi.getReviewsOfModule(module._id);\n    setReviewsList(newReviews);\n  };\n\n  const checkIsRatedByUser = async () => {\n    try {\n      const rating = await reviewApi.getRating(\"mod\", userId, \"star\");\n      setRatingByUser(rating);\n    } catch (err) {\n      setRatingByUser(null);\n    }\n  };\n\n  const menu = (\n    <Menu>\n      <Menu.Item>Newest</Menu.Item>\n      <Menu.Item>Oldest</Menu.Item>\n      <Menu.Item>Most Likes</Menu.Item>\n      <Menu.Item>Most Comments</Menu.Item>\n    </Menu>\n  );\n\n  const renderPage = () => {\n    return module ? (\n      <>\n        <ModuleInformation\n          module={module}\n          setAddReviewModalVisibility={setAddReviewModalVisibility}\n          setAddRatingsModalVisibility={setAddRatingsModalVisibility}\n        />\n        <div style={styles.reviewsHeader}>\n          <span style={styles.reviewsHeaderTitle}>Reviews</span>\n          <Dropdown overlay={menu}>\n            <div style={{ marginRight: 20 }}>\n              <a style={{ color: \"#595959\", marginRight: 6, fontSize: 18 }}>\n                Sort\n              </a>\n              <DownOutlined />\n            </div>\n          </Dropdown>\n        </div>\n        <ReviewList updateReviews={updateReviews} reviews={reviewsList} />\n        <AddReviewModal\n          code={module.code}\n          modId={module._id}\n          updateReviews={updateReviews}\n          isModalVisible={isAddReviewModalVisible}\n          setModalVisibility={setAddReviewModalVisibility}\n          reviewByUser={reviewByUser}\n        />\n        <AddRatingsModal\n          code={module.code}\n          modId={module._id}\n          isModalVisible={isAddRatingsModalVisible}\n          setModalVisibility={setAddRatingsModalVisibility}\n          ratingsByUser={ratingByUser}\n        />\n      </>\n    ) : (\n      <div style={styles.moduleNotFoundPage}>\n        <span style={{}}>Module not found!</span>\n      </div>\n    );\n  };\n\n  return renderPage();\n};\n\nconst styles = {\n  reviewsHeader: {\n    height: \"8vh\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    padding: \"0px 10px\",\n    fontFamily: \"Mukta\",\n    color: \"#838383\",\n  },\n  reviewsHeaderTitle: {\n    fontSize: \"26px\",\n  },\n  moduleNotFoundPage: {\n    display: \"flex\",\n    height: \"80vh\",\n    width: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n};\n\nModuleReviewPage.getInitialProps = async ({ query }) => {\n  const moduleId: string = query.id as string;\n  try {\n    const module = await moduleApi.getModule(moduleId);\n    const prereqs = await Promise.all(\n      module.prereqs.map(async (prereqId) => {\n        const mod = await moduleApi.getModule(prereqId);\n        return mod.code;\n      })\n    );\n    module.prereqs = prereqs;\n\n    const reviews = await reviewApi.getReviewsOfModule(module._id);\n\n    return { module, reviews };\n  } catch (err) {\n    return { module: null, reviews: [] };\n  }\n};\n\nexport default ModuleReviewPage;\n\n// const dummyReviews: Review[] = [\n//   {\n//     userName: \"Thomas Tan\",\n//     likes: 79,\n//     text: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer eget bibendum purus, sed ultricies nunc. Proin et purus odio. Etiam ex elit, consectetur placerat feugiat non, luctus eu justo. Vestibulum quis accumsan orci. Morbi ante massa, semper in mi eleifend, tempor posuere quam. In odio nulla, tristique et lorem vitae, mollis dictum ipsum. Sed sollicitudin augue quis turpis hendrerit laoreet. Nam facilisis turpis leo, in lobortis lorem lobortis vel. Maecenas scelerisque ante vel elit lobortis lobortis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nulla ac imperdiet erat. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Mauris eu purus at urna facilisis eleifend. Ut dapibus, ex vitae vehicula suscipit, enim lacus vulputate tortor, vel convallis diam dui quis est. Duis cursus velit enim, vitae interdum nisi facilisis ut. In porttitor lacus vulputate lacinia semper. Vivamus consectetur felis vitae felis maximus sodales. Sed scelerisque blandit consectetur. Duis nec dictum ligula, quis lobortis ipsum. Ut rhoncus, nulla quis cursus euismod, quam metus pellentesque nulla, sit amet gravida felis libero id urna. Aenean a nunc imperdiet, vestibulum nibh nec, pretium tortor. Mauris magna nisl, porta eget orci eu, sodales gravida nulla. Sed eleifend dapibus libero quis fermentum. Vivamus non hendrerit augue.\",\n//     yearTaken: 2020,\n//     semesterTaken: 1,\n//     workload: 10,\n//     rating: {\n//       difficulty: 5,\n//       star: 5\n//     },\n//     _id: \"1\"\n//   },\n//   {\n//     userName: \"Susan Lim\",\n//     likes: 24,\n//     text: \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer eget bibendum purus, sed ultricies nunc. Proin et purus odio. Etiam ex elit, consectetur placerat feugiat non, luctus eu justo. Vestibulum quis accumsan orci. Morbi ante massa, semper in mi eleifend, tempor posuere quam. In odio nulla, tristique et lorem vitae, mollis dictum ipsum. Sed sollicitudin augue quis turpis hendrerit laoreet. Nam facilisis turpis leo, in lobortis lorem lobortis vel. Maecenas scelerisque ante vel elit lobortis lobortis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.\",\n//     yearTaken: 2020,\n//     semesterTaken: 1,\n//     workload: 10,\n//     rating: {\n//       difficulty: 5,\n//       star: 5\n//     },\n//     _id: \"2\"\n//   }\n// ]\n"]},"metadata":{},"sourceType":"module"}