{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectDestructuringEmpty from \"@babel/runtime/helpers/esm/objectDestructuringEmpty\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/zhangxian/Desktop/RottenMods/frontend/pages/home.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport HomeModuleList from \"../components/HomeModuleList\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport { useSelector } from \"react-redux\";\nimport recommendationApi from \"../api/recommendations\";\nimport moduleApi from \"../api/module\";\nimport { useEffect, useState } from \"react\";\n\nvar Home = function Home(_ref) {\n  _s();\n\n  _objectDestructuringEmpty(_ref);\n\n  var isLoggedIn = useSelector(function (state) {\n    return state.auth.isLoggedIn;\n  });\n  var userId = useSelector(function (state) {\n    var _state$auth$user;\n\n    return (_state$auth$user = state.auth.user) === null || _state$auth$user === void 0 ? void 0 : _state$auth$user._id;\n  });\n\n  var _useState = useState([]),\n      trendingModules = _useState[0],\n      setTrendingModules = _useState[1];\n\n  var _useState2 = useState([]),\n      popularModules = _useState2[0],\n      setPopularModules = _useState2[1];\n\n  var _useState3 = useState([]),\n      recommendedModules = _useState3[0],\n      setRecommendedModules = _useState3[1];\n\n  useEffect(function () {\n    fetchAllRecommendations();\n  }, [userId]);\n\n  var fetchAllRecommendations = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var backupModules, concatBackup, _recommendedModules;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return moduleApi.searchModule(\"cs1\");\n\n            case 2:\n              backupModules = _context.sent;\n\n              concatBackup = function concatBackup(modulesToRecommend, setModulesMethod) {\n                if (modulesToRecommend.length < 3) {\n                  var sufficientModules = modulesToRecommend.concat(backupModules);\n                  setModulesMethod(sufficientModules);\n                } else {\n                  setModulesMethod(modulesToRecommend);\n                }\n              };\n\n              recommendationApi.getMostRatedModules().then(function (response) {\n                concatBackup(response.mods, setPopularModules);\n              })[\"catch\"](function (error) {\n                // no modules\n                concatBackup([], setPopularModules);\n              }); // const mostRatedModules = await \n              // if (mostRatedModules) {\n              //   concatBackup(mostRatedModules.mods, setPopularModules);\n              // } else {\n              //   concatBackup([], setPopularModules)\n              // }\n\n              recommendationApi.getMostViewedModules().then(function (response) {\n                concatBackup(response.mods, setTrendingModules);\n              })[\"catch\"](function (error) {\n                // no modules\n                concatBackup([], setTrendingModules);\n              });\n              _context.prev = 6;\n\n              if (!userId) {\n                _context.next = 12;\n                break;\n              }\n\n              _context.next = 10;\n              return recommendationApi.getRecommendedModules(userId);\n\n            case 10:\n              _recommendedModules = _context.sent;\n              concatBackup(_recommendedModules.mods, setRecommendedModules);\n\n            case 12:\n              _context.next = 17;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](6);\n              console.log(\"User has insufficient activities to get recommended\");\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[6, 14]]);\n    }));\n\n    return function fetchAllRecommendations() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var renderRecommendedModules = function renderRecommendedModules() {\n    if (userId) {\n      if (recommendedModules.length > 0) {\n        console.log(\"Recommended:\", recommendedModules);\n        return __jsx(React.Fragment, null, __jsx(SectionTitle, {\n          title: \"Recommended For You\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 13\n          }\n        }), __jsx(HomeModuleList, {\n          modules: recommendedModules,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }\n        }));\n      } else {\n        return __jsx(React.Fragment, null, __jsx(SectionTitle, {\n          title: \"Recommended For You\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 13\n          }\n        }), __jsx(\"p\", {\n          style: {\n            textAlign: \"center\",\n            paddingTop: \"20px\"\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 13\n          }\n        }, \"Sorry we do not have enough information about you yet to recommend modules for you!\"));\n      }\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(ModuleCompareModal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }), __jsx(SectionTitle, {\n    title: \"Trending Modules\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }), __jsx(HomeModuleList, {\n    modules: trendingModules,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }), __jsx(SectionTitle, {\n    title: \"Popular Modules\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }\n  }), __jsx(HomeModuleList, {\n    modules: popularModules,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }\n  }), isLoggedIn && renderRecommendedModules());\n};\n\n_s(Home, \"StlPpzqT7HrJNURzMuVCVl+tjfU=\", false, function () {\n  return [useSelector, useSelector];\n});\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/Users/zhangxian/Desktop/RottenMods/frontend/pages/home.tsx"],"names":["HomeModuleList","SectionTitle","ModuleCompareModal","useSelector","recommendationApi","moduleApi","useEffect","useState","Home","isLoggedIn","state","auth","userId","user","_id","trendingModules","setTrendingModules","popularModules","setPopularModules","recommendedModules","setRecommendedModules","fetchAllRecommendations","searchModule","backupModules","concatBackup","modulesToRecommend","setModulesMethod","length","sufficientModules","concat","getMostRatedModules","then","response","mods","error","getMostViewedModules","getRecommendedModules","console","log","renderRecommendedModules","textAlign","paddingTop"],"mappings":"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","sourcesContent":["import { NextPage } from \"next\";\n\nimport HomeModuleList from \"../components/HomeModuleList\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport { useSelector } from \"react-redux\";\nimport recommendationApi from \"../api/recommendations\";\nimport moduleApi from \"../api/module\";\n\nimport { useEffect, useState } from \"react\";\n\nconst Home: NextPage = ({}) => {\n  const isLoggedIn = useSelector((state) => state.auth.isLoggedIn);\n  const userId = useSelector((state) => state.auth.user?._id);\n\n  const [trendingModules, setTrendingModules] = useState([]);\n  const [popularModules, setPopularModules] = useState([]);\n  const [recommendedModules, setRecommendedModules] = useState([]);\n\n  useEffect(() => {\n    fetchAllRecommendations();\n  }, [userId]);\n\n  const fetchAllRecommendations = async () => {\n    const backupModules = await moduleApi.searchModule(\"cs1\");\n\n    const concatBackup = (modulesToRecommend, setModulesMethod) => {\n      if (modulesToRecommend.length < 3) {\n        const sufficientModules = modulesToRecommend.concat(backupModules);\n        setModulesMethod(sufficientModules);\n      } else {\n        setModulesMethod(modulesToRecommend);\n      }\n    };\n\n\n    recommendationApi.getMostRatedModules()\n      .then((response) => {\n        concatBackup(response.mods, setPopularModules);\n      })\n      .catch((error)=> {\n        // no modules\n        concatBackup([], setPopularModules);\n      })\n    // const mostRatedModules = await \n    // if (mostRatedModules) {\n    //   concatBackup(mostRatedModules.mods, setPopularModules);\n    // } else {\n    //   concatBackup([], setPopularModules)\n    // }\n    recommendationApi.getMostViewedModules()\n      .then((response) => {\n        concatBackup(response.mods, setTrendingModules);\n      })\n      .catch((error)=> {\n        // no modules\n        concatBackup([], setTrendingModules);\n      })\n\n    \n    try {\n      if (userId) {\n        const recommendedModules = await recommendationApi.getRecommendedModules(\n          userId\n        );\n        concatBackup(recommendedModules.mods, setRecommendedModules);\n      }\n    } catch (err) {\n      console.log(\"User has insufficient activities to get recommended\");\n    }\n  };\n\n  const renderRecommendedModules = () => {\n    if (userId) {\n      if (recommendedModules.length > 0) {\n        console.log(\"Recommended:\", recommendedModules);\n        return (\n          <>\n            <SectionTitle title=\"Recommended For You\" />\n            <HomeModuleList modules={recommendedModules} />\n          </>\n        );\n      } else {\n        return (\n          <>\n            <SectionTitle title=\"Recommended For You\" />\n            <p style={{ textAlign: \"center\", paddingTop: \"20px\" }}>\n              Sorry we do not have enough information about you yet to recommend\n              modules for you!\n            </p>\n          </>\n        );\n      }\n    }\n  };\n\n  return (\n    <>\n      <ModuleCompareModal />\n      <SectionTitle title=\"Trending Modules\" />\n      <HomeModuleList modules={trendingModules} />\n      <SectionTitle title=\"Popular Modules\" />\n      <HomeModuleList modules={popularModules} />\n      {isLoggedIn && renderRecommendedModules()}\n    </>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}