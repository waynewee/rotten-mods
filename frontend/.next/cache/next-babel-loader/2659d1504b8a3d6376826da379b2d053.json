{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/ChesterSim/Desktop/NUS Computer Science/CS3219/cs3219-ay2021-s1-project-2020-s1-g01/frontend/components/ReviewCard.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport commentApi from \"../api/comment\";\nimport reactionApi from \"../api/reaction\";\nimport reviewApi from \"../api/review\";\nimport { triggerRequireLoginMessage } from \"../utils/helpers\";\nimport AddCommentModal from \"./AddCommentModal\";\nimport Button from \"./Button\";\nimport CommentModal from \"./CommentsModal\";\nimport CommentOutlinedIcon from \"../icons/CommentOutlinedIcon\";\nimport LikeOutlinedIcon from \"../icons/LikeOutlinedIcon\";\nimport { reviewBlue, ratingsYellow } from \"../styles/colors\";\n\nvar ReviewCard = function ReviewCard(_ref) {\n  _s();\n\n  var _reaction$like$count, _reaction$like;\n\n  var review = _ref.review,\n      updateReviews = _ref.updateReviews,\n      _ref$showActions = _ref.showActions,\n      showActions = _ref$showActions === void 0 ? true : _ref$showActions;\n\n  var _useState = useState(false),\n      isCommentsModalVisible = _useState[0],\n      setCommentsModalVisibility = _useState[1];\n\n  var _useState2 = useState(false),\n      isAddCommentModalVisible = _useState2[0],\n      setAddCommentModalVisibility = _useState2[1];\n\n  var _useState3 = useState([]),\n      comments = _useState3[0],\n      setComments = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      userLikeReactionId = _useState4[0],\n      setUserLikeReactionId = _useState4[1];\n\n  var _useState5 = useState(3),\n      difficulty = _useState5[0],\n      setDifficulty = _useState5[1];\n\n  var _useState6 = useState(3),\n      star = _useState6[0],\n      setStar = _useState6[1];\n\n  var isLoggedIn = useSelector(function (state) {\n    return state.auth.isLoggedIn;\n  });\n  var userId = useSelector(function (state) {\n    var _state$auth$user;\n\n    return (_state$auth$user = state.auth.user) === null || _state$auth$user === void 0 ? void 0 : _state$auth$user._id;\n  });\n  var user = review.user,\n      text = review.text,\n      acadYearTaken = review.acadYearTaken,\n      semesterTaken = review.semesterTaken,\n      reaction = review.reaction,\n      _id = review._id,\n      ratingIds = review.ratingIds;\n  var name = user === null || user === void 0 ? void 0 : user.name;\n  var like = (_reaction$like$count = reaction === null || reaction === void 0 ? void 0 : (_reaction$like = reaction.like) === null || _reaction$like === void 0 ? void 0 : _reaction$like.count) !== null && _reaction$like$count !== void 0 ? _reaction$like$count : 0;\n  useEffect(function () {\n    fetchRatings();\n    fetchComments();\n    checkIsLikedByUser();\n  }, []);\n\n  var fetchComments = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var fetchedComments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return commentApi.getCommentsOfReview(_id);\n\n            case 2:\n              fetchedComments = _context.sent;\n              setComments(fetchedComments);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function fetchComments() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var checkIsLikedByUser = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var likeReaction;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return reactionApi.getReaction(\"review\", _id, userId, \"like\");\n\n            case 3:\n              likeReaction = _context2.sent;\n              setUserLikeReactionId(likeReaction._id);\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              setUserLikeReactionId(\"\");\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function checkIsLikedByUser() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onLikeReview = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (isLoggedIn) {\n                _context3.next = 3;\n                break;\n              }\n\n              triggerRequireLoginMessage();\n              return _context3.abrupt(\"return\");\n\n            case 3:\n              if (userLikeReactionId) {\n                _context3.next = 10;\n                break;\n              }\n\n              _context3.next = 6;\n              return reactionApi.addReaction(\"review\", _id, userId, \"like\");\n\n            case 6:\n              updateReviews();\n              checkIsLikedByUser();\n              _context3.next = 14;\n              break;\n\n            case 10:\n              _context3.next = 12;\n              return reactionApi.deleteReaction(userLikeReactionId);\n\n            case 12:\n              updateReviews();\n              checkIsLikedByUser();\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onLikeReview() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var toggleCommentModalVisibility = function toggleCommentModalVisibility() {\n    if (!isLoggedIn) {\n      triggerRequireLoginMessage();\n    } else {\n      setAddCommentModalVisibility(true);\n    }\n  };\n\n  var fetchRatings = function fetchRatings() {\n    ratingIds.forEach( /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id) {\n        var rating;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return reviewApi.getRatingById(id);\n\n              case 2:\n                rating = _context4.sent;\n\n                if (rating.type == \"star\") {} else if (rating.type == \"difficulty\") console.log(rating.type);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function (_x) {\n        return _ref5.apply(this, arguments);\n      };\n    }());\n  };\n\n  return __jsx(\"div\", {\n    style: styles.container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    style: styles.header,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    style: styles.userInformation,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 11\n    }\n  }, name), __jsx(\"span\", {\n    style: styles.divider,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 11\n    }\n  }, \"|\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }, \"AY\", acadYearTaken, \", Sem \", semesterTaken), __jsx(\"span\", {\n    style: styles.divider,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 11\n    }\n  }, \"|\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  }, \"Difficulty: \", difficulty.toFixed(1)), __jsx(\"span\", {\n    style: styles.divider,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 11\n    }\n  }, \"|\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 11\n    }\n  }, \"Rating: \", star.toFixed(1))), showActions && __jsx(\"div\", {\n    style: styles.actionsBar,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    style: styles.action,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    onClick: onLikeReview,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 15\n    }\n  }, __jsx(LikeOutlinedIcon, {\n    style: _objectSpread(_objectSpread({}, styles.icon), {}, {\n      color: userLikeReactionId ? ratingsYellow : \"#fff\"\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 17\n    }\n  })), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 15\n    }\n  }, \"\".concat(like, \" Likes\"))), __jsx(\"span\", {\n    style: {\n      margin: \"0px 10px\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }\n  }, \"|\"), __jsx(\"div\", {\n    style: styles.action,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    onClick: toggleCommentModalVisibility,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 15\n    }\n  }, __jsx(CommentOutlinedIcon, {\n    style: styles.icon,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 17\n    }\n  })), __jsx(Button, {\n    onClick: function onClick() {\n      return setCommentsModalVisibility(true);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 15\n    }\n  }, \"\".concat(comments.length, \" Comments\"))))), __jsx(\"div\", {\n    style: styles.review,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, text), __jsx(AddCommentModal, {\n    fetchComments: fetchComments,\n    reviewId: _id,\n    isModalVisible: isAddCommentModalVisible,\n    setModalVisibility: setAddCommentModalVisibility,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }), __jsx(CommentModal, {\n    comments: comments,\n    isModalVisible: isCommentsModalVisible,\n    setModalVisibility: setCommentsModalVisibility,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }));\n};\n\n_s(ReviewCard, \"4hNke/TOb6Ol04OVG0A1pMfIPMk=\", false, function () {\n  return [useSelector, useSelector];\n});\n\n_c = ReviewCard;\nvar styles = {\n  container: {\n    padding: 30,\n    backgroundColor: reviewBlue,\n    color: \"#fff\",\n    borderRadius: 15,\n    boxShadow: \"0px 8px 8px rgba(0, 0, 0, 0.25)\",\n    marginBottom: 15,\n    width: \"100%\"\n  },\n  header: {\n    display: \"flex\",\n    justifyContent: \"space-between\"\n  },\n  userInformation: {\n    display: \"flex\",\n    flexWrap: \"wrap\"\n  },\n  actionsBar: {\n    display: \"flex\"\n  },\n  action: {\n    display: \"flex\",\n    justifyContent: \"center\"\n  },\n  icon: {\n    height: 20,\n    marginRight: 10\n  },\n  review: {\n    marginTop: 10,\n    textAlign: \"justify\"\n  },\n  divider: {\n    margin: \"0px 10px\"\n  }\n};\nexport default ReviewCard;\n\nvar _c;\n\n$RefreshReg$(_c, \"ReviewCard\");","map":{"version":3,"sources":["/Users/ChesterSim/Desktop/NUS Computer Science/CS3219/cs3219-ay2021-s1-project-2020-s1-g01/frontend/components/ReviewCard.tsx"],"names":["useState","useEffect","useSelector","commentApi","reactionApi","reviewApi","triggerRequireLoginMessage","AddCommentModal","Button","CommentModal","CommentOutlinedIcon","LikeOutlinedIcon","reviewBlue","ratingsYellow","ReviewCard","review","updateReviews","showActions","isCommentsModalVisible","setCommentsModalVisibility","isAddCommentModalVisible","setAddCommentModalVisibility","comments","setComments","userLikeReactionId","setUserLikeReactionId","difficulty","setDifficulty","star","setStar","isLoggedIn","state","auth","userId","user","_id","text","acadYearTaken","semesterTaken","reaction","ratingIds","name","like","count","fetchRatings","fetchComments","checkIsLikedByUser","getCommentsOfReview","fetchedComments","getReaction","likeReaction","onLikeReview","addReaction","deleteReaction","toggleCommentModalVisibility","forEach","id","getRatingById","rating","type","console","log","styles","container","header","userInformation","divider","toFixed","actionsBar","action","icon","color","margin","length","padding","backgroundColor","borderRadius","boxShadow","marginBottom","width","display","justifyContent","flexWrap","height","marginRight","marginTop","textAlign"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Review } from \"../types\";\nimport commentApi from \"../api/comment\";\nimport reactionApi from \"../api/reaction\";\nimport reviewApi from \"../api/review\";\nimport { triggerRequireLoginMessage } from \"../utils/helpers\";\n\nimport AddCommentModal from \"./AddCommentModal\";\nimport Button from \"./Button\";\nimport CommentModal from \"./CommentsModal\";\nimport CommentOutlinedIcon from \"../icons/CommentOutlinedIcon\";\nimport LikeOutlinedIcon from \"../icons/LikeOutlinedIcon\";\nimport { reviewBlue, ratingsYellow } from \"../styles/colors\";\n\ninterface ReviewCardProps {\n  review: Review;\n  updateReviews: () => void;\n  showActions?: boolean;\n}\n\nconst ReviewCard: React.FC<ReviewCardProps> = ({\n  review,\n  updateReviews,\n  showActions = true,\n}) => {\n  const [isCommentsModalVisible, setCommentsModalVisibility] = useState(false);\n  const [isAddCommentModalVisible, setAddCommentModalVisibility] = useState(\n    false\n  );\n  const [comments, setComments] = useState([]);\n  const [userLikeReactionId, setUserLikeReactionId] = useState(\"\");\n  const [difficulty, setDifficulty] = useState(3);\n  const [star, setStar] = useState(3);\n\n  const isLoggedIn = useSelector((state) => state.auth.isLoggedIn);\n  const userId = useSelector((state) => state.auth.user?._id);\n\n  const {\n    user,\n    text,\n    acadYearTaken,\n    semesterTaken,\n    reaction,\n    _id,\n    ratingIds,\n  } = review;\n  const name = user?.name;\n  const like = reaction?.like?.count ?? 0;\n\n  useEffect(() => {\n    fetchRatings();\n    fetchComments();\n    checkIsLikedByUser();\n  }, []);\n\n  const fetchComments = async () => {\n    const fetchedComments = await commentApi.getCommentsOfReview(_id);\n    setComments(fetchedComments);\n  };\n\n  const checkIsLikedByUser = async () => {\n    try {\n      const likeReaction = await reactionApi.getReaction(\n        \"review\",\n        _id,\n        userId,\n        \"like\"\n      );\n      setUserLikeReactionId(likeReaction._id);\n    } catch (err) {\n      setUserLikeReactionId(\"\");\n    }\n  };\n\n  const onLikeReview = async () => {\n    if (!isLoggedIn) {\n      triggerRequireLoginMessage();\n      return;\n    }\n\n    if (!userLikeReactionId) {\n      await reactionApi.addReaction(\"review\", _id, userId, \"like\");\n      updateReviews();\n      checkIsLikedByUser();\n    } else {\n      await reactionApi.deleteReaction(userLikeReactionId);\n      updateReviews();\n      checkIsLikedByUser();\n    }\n  };\n\n  const toggleCommentModalVisibility = () => {\n    if (!isLoggedIn) {\n      triggerRequireLoginMessage();\n    } else {\n      setAddCommentModalVisibility(true);\n    }\n  };\n\n  const fetchRatings = () => {\n    ratingIds.forEach(async (id) => {\n      const rating = await reviewApi.getRatingById(id);\n      if (rating.type == \"star\") {\n        \n      } else if (rating.type == \"difficulty\")\n      console.log(rating.type);\n    });\n  };\n\n  return (\n    <div style={styles.container}>\n      <div style={styles.header}>\n        <div style={styles.userInformation}>\n          <span>{name}</span>\n          <span style={styles.divider}>|</span>\n          <span>\n            AY{acadYearTaken}, Sem {semesterTaken}\n          </span>\n          <span style={styles.divider}>|</span>\n          <span>Difficulty: {difficulty.toFixed(1)}</span>\n          <span style={styles.divider}>|</span>\n          <span>Rating: {star.toFixed(1)}</span>\n        </div>\n        {showActions && (\n          <div style={styles.actionsBar}>\n            <div style={styles.action}>\n              <Button onClick={onLikeReview}>\n                <LikeOutlinedIcon\n                  style={{\n                    ...styles.icon,\n                    color: userLikeReactionId ? ratingsYellow : \"#fff\",\n                  }}\n                />\n              </Button>\n              <span>{`${like} Likes`}</span>\n            </div>\n            <span style={{ margin: \"0px 10px\" }}>|</span>\n            <div style={styles.action}>\n              <Button onClick={toggleCommentModalVisibility}>\n                <CommentOutlinedIcon style={styles.icon} />\n              </Button>\n              <Button onClick={() => setCommentsModalVisibility(true)}>\n                {`${comments.length} Comments`}\n              </Button>\n            </div>\n          </div>\n        )}\n      </div>\n      <div style={styles.review}>{text}</div>\n      <AddCommentModal\n        fetchComments={fetchComments}\n        reviewId={_id}\n        isModalVisible={isAddCommentModalVisible}\n        setModalVisibility={setAddCommentModalVisibility}\n      />\n      <CommentModal\n        comments={comments}\n        isModalVisible={isCommentsModalVisible}\n        setModalVisibility={setCommentsModalVisibility}\n      />\n    </div>\n  );\n};\n\nconst styles = {\n  container: {\n    padding: 30,\n    backgroundColor: reviewBlue,\n    color: \"#fff\",\n    borderRadius: 15,\n    boxShadow: \"0px 8px 8px rgba(0, 0, 0, 0.25)\",\n    marginBottom: 15,\n    width: \"100%\",\n  },\n  header: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n  },\n  userInformation: {\n    display: \"flex\",\n    flexWrap: \"wrap\" as \"wrap\",\n  },\n  actionsBar: {\n    display: \"flex\",\n  },\n  action: {\n    display: \"flex\",\n    justifyContent: \"center\",\n  },\n  icon: {\n    height: 20,\n    marginRight: 10,\n  },\n  review: {\n    marginTop: 10,\n    textAlign: \"justify\" as \"justify\",\n  },\n  divider: {\n    margin: \"0px 10px\",\n  },\n};\n\nexport default ReviewCard;\n"]},"metadata":{},"sourceType":"module"}