{"ast":null,"code":"import _readOnlyError from \"@babel/runtime/helpers/esm/readOnlyError\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { LOG_USER_IN, LOG_USER_OUT } from \"../redux/constants\";\nimport authApi from \"../api/auth\";\nimport courseApi from \"../api/course\";\nimport { message } from 'antd';\n\nfunction signUp(_x) {\n  return _signUp.apply(this, arguments);\n}\n\nfunction _signUp() {\n  _signUp = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n    var fullname, emailaddress, userpassword, university, course, yearofstudy, data;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log(\"Sign Up Service received\");\n            console.log(values);\n            fullname = values.fullname, emailaddress = values.emailaddress, userpassword = values.userpassword, university = values.university, course = values.course, yearofstudy = values.yearofstudy; // let createUserConfig = {\n            //     method: 'post',\n            //     url: 'http://localhost:8080/api/user',\n            //     headers: {\n            //         'Content-Type': 'application/json'\n            //     },\n            //     data: {\n            //         \"name\": values.fullname,\n            //         \"email\": values.emailaddress,\n            //         \"password\": values.userpassword,\n            //         \"schoolId\": values.university,\n            //         \"courseId\": values.course,\n            //         \"currentYear\": values.yearofstudy\n            //     }\n            // };\n            // let createSchoolConfig = {\n            //     method: 'post',\n            //     url: 'http://localhost:8080/api/school',\n            //     headers: {\n            //         'Content-Type': 'application/json'\n            //     },\n            //     data: {\n            //         \"name\": values.fullname,\n            //     }\n            // };\n            // let createCourseConfig = {\n            //     method: 'post',\n            //     url: 'http://localhost:8080/api/course',\n            //     headers: {\n            //         'Content-Type': 'application/json'\n            //     },\n            //     data: {\n            //         \"name\": values.fullname,\n            //     }\n            // };\n            // if schoolId is user created, then create a new school in the system\n\n            if (!(course !== \"userCreated\" && university !== \"userCreated\")) {\n              _context.next = 8;\n              break;\n            }\n\n            _context.next = 6;\n            return authApi.signUp(fullname, emailaddress, userpassword, university, course, yearofstudy);\n\n          case 6:\n            data = _context.sent;\n            console.log(\"sign up success\"); // login user \n            // axios(createUserConfig)\n            //     .then(function (response) {\n            //         console.log(\"post is successful\");\n            //         console.log(response);\n            //     })\n            //     .catch(function (error) {\n            //         console.log(error);\n            //     });\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _signUp.apply(this, arguments);\n}\n\nfunction logIn(_x2, _x3) {\n  return _logIn.apply(this, arguments);\n}\n\nfunction _logIn() {\n  _logIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values, dispatch) {\n    var emailaddress, password, data, _data, name, currentYear, courseId, _id, courseData, user;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            emailaddress = values.emailaddress, password = values.password;\n            data = null;\n            _context2.prev = 2;\n\n            _readOnlyError(\"data\");\n\n            _context2.next = 6;\n            return authApi.logIn(emailaddress, password);\n\n          case 6:\n            data = _context2.sent;\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](2);\n            message.error(\"ERROR\");\n\n          case 12:\n            _data = data, name = _data.name, currentYear = _data.currentYear, courseId = _data.courseId, _id = _data._id;\n            _context2.next = 15;\n            return courseApi.getCourse(courseId);\n\n          case 15:\n            courseData = _context2.sent;\n            console.log(courseData);\n            user = {\n              fullName: name,\n              yearOfStudy: currentYear,\n              studyCourse: courseData.name,\n              _id: _id\n            };\n            window.localStorage.setItem(\"ROTTENMODS_EMAIL\", emailaddress);\n            window.localStorage.setItem(\"ROTTENMODS_PASSWORD\", password);\n            dispatch({\n              type: LOG_USER_IN,\n              payload: user\n            });\n\n          case 21:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[2, 9]]);\n  }));\n  return _logIn.apply(this, arguments);\n}\n\nfunction logOut(dispatch) {\n  window.localStorage.removeItem(\"ROTTENMODS_EMAIL\");\n  window.localStorage.removeItem(\"ROTTENMODS_PASSWORD\");\n  dispatch({\n    type: LOG_USER_OUT\n  });\n}\n\nexport default {\n  signUp: signUp,\n  logIn: logIn,\n  logOut: logOut\n};","map":{"version":3,"sources":["/Users/zhangxian/Desktop/RottenMods/frontend/services/authentication.tsx"],"names":["LOG_USER_IN","LOG_USER_OUT","authApi","courseApi","message","signUp","values","console","log","fullname","emailaddress","userpassword","university","course","yearofstudy","data","logIn","dispatch","password","error","name","currentYear","courseId","_id","getCourse","courseData","user","fullName","yearOfStudy","studyCourse","window","localStorage","setItem","type","payload","logOut","removeItem"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { LOG_USER_IN, LOG_USER_OUT } from \"../redux/constants\";\nimport { User } from \"../types\";\nimport authApi from \"../api/auth\";\nimport courseApi from \"../api/course\";\nimport { message, Button } from 'antd';\n\n\n\nasync function signUp(values) {\n    console.log(\"Sign Up Service received\");\n    console.log(values);\n\n\n    const {fullname, emailaddress, userpassword, university, course, yearofstudy} = values;\n\n    // let createUserConfig = {\n    //     method: 'post',\n    //     url: 'http://localhost:8080/api/user',\n    //     headers: {\n    //         'Content-Type': 'application/json'\n    //     },\n    //     data: {\n    //         \"name\": values.fullname,\n    //         \"email\": values.emailaddress,\n    //         \"password\": values.userpassword,\n    //         \"schoolId\": values.university,\n    //         \"courseId\": values.course,\n    //         \"currentYear\": values.yearofstudy\n    //     }\n    // };\n\n    // let createSchoolConfig = {\n    //     method: 'post',\n    //     url: 'http://localhost:8080/api/school',\n    //     headers: {\n    //         'Content-Type': 'application/json'\n    //     },\n    //     data: {\n    //         \"name\": values.fullname,\n    //     }\n    // };\n\n    // let createCourseConfig = {\n    //     method: 'post',\n    //     url: 'http://localhost:8080/api/course',\n    //     headers: {\n    //         'Content-Type': 'application/json'\n    //     },\n    //     data: {\n    //         \"name\": values.fullname,\n    //     }\n    // };\n\n\n    // if schoolId is user created, then create a new school in the system\n\n    if (course !== \"userCreated\" && university !== \"userCreated\") {\n        \n        const data = await authApi.signUp(fullname, emailaddress, userpassword, university, course, yearofstudy);\n        console.log(\"sign up success\");\n        // login user \n\n        // axios(createUserConfig)\n        //     .then(function (response) {\n        //         console.log(\"post is successful\");\n        //         console.log(response);\n        //     })\n        //     .catch(function (error) {\n        //         console.log(error);\n        //     });\n    }\n\n}\n\n\nasync function logIn(values, dispatch) {\n    const { emailaddress, password } = values;\n    const data = null;\n    try {\n        data = await authApi.logIn(emailaddress, password);\n    } catch {\n        message.error(\"ERROR\");\n    }\n    \n    const { name, currentYear, courseId, _id } = data;\n    const courseData = await courseApi.getCourse(courseId);\n    console.log(courseData);\n    const user: User = {\n        fullName: name,\n        yearOfStudy: currentYear,\n        studyCourse: courseData.name,\n        _id\n    }\n\n    window.localStorage.setItem(\"ROTTENMODS_EMAIL\", emailaddress);\n    window.localStorage.setItem(\"ROTTENMODS_PASSWORD\", password);\n\n    dispatch({\n        type: LOG_USER_IN,\n        payload: user\n    });\n\n}\n\nfunction logOut(dispatch) {\n    window.localStorage.removeItem(\"ROTTENMODS_EMAIL\");\n    window.localStorage.removeItem(\"ROTTENMODS_PASSWORD\");\n\n    dispatch({\n        type: LOG_USER_OUT,\n    })\n\n}\n\nexport default {\n    signUp,\n    logIn,\n    logOut\n}"]},"metadata":{},"sourceType":"module"}