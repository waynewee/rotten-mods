{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectDestructuringEmpty from \"@babel/runtime/helpers/esm/objectDestructuringEmpty\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/ChesterSim/Desktop/NUS Computer Science/CS3219/cs3219-ay2021-s1-project-2020-s1-g01/frontend/pages/home.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport HomeModuleList from \"../components/HomeModuleList\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport { useSelector } from \"react-redux\";\nimport recommendationApi from \"../api/recommendations\";\nimport moduleApi from \"../api/module\";\nimport { useEffect, useState } from \"react\";\n\nvar Home = function Home(_ref) {\n  _s();\n\n  _objectDestructuringEmpty(_ref);\n\n  var isLoggedIn = useSelector(function (state) {\n    return state.auth.isLoggedIn;\n  });\n  var userId = useSelector(function (state) {\n    var _state$auth$user;\n\n    return (_state$auth$user = state.auth.user) === null || _state$auth$user === void 0 ? void 0 : _state$auth$user._id;\n  });\n\n  var _useState = useState([]),\n      trendingModules = _useState[0],\n      setTrendingModules = _useState[1];\n\n  var _useState2 = useState([]),\n      popularModules = _useState2[0],\n      setPopularModules = _useState2[1];\n\n  var _useState3 = useState([]),\n      recommendedModules = _useState3[0],\n      setRecommendedModules = _useState3[1];\n\n  useEffect(function () {\n    fetchAllRecommendations();\n  }, [userId]);\n\n  var fetchAllRecommendations = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var backupModules, concatBackup, mostRatedModules, mostViewedModules, _recommendedModules;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return moduleApi.searchModule(\"\");\n\n            case 2:\n              backupModules = _context.sent;\n\n              concatBackup = function concatBackup(modulesToRecommend, setModulesMethod) {\n                if (modulesToRecommend.length < 3) {\n                  modulesToRecommend.concat(backupModules);\n                }\n              };\n\n              _context.next = 6;\n              return recommendationApi.getMostRatedModules();\n\n            case 6:\n              mostRatedModules = _context.sent;\n              setPopularModules(mostRatedModules.mods);\n              _context.next = 10;\n              return recommendationApi.getMostViewedModules();\n\n            case 10:\n              mostViewedModules = _context.sent;\n              setTrendingModules(mostViewedModules.mods);\n              _context.prev = 12;\n              _context.next = 15;\n              return recommendationApi.getRecommendedModules(userId);\n\n            case 15:\n              _recommendedModules = _context.sent;\n              setRecommendedModules(_recommendedModules.mods);\n              _context.next = 22;\n              break;\n\n            case 19:\n              _context.prev = 19;\n              _context.t0 = _context[\"catch\"](12);\n              console.log(\"User has insufficient activities to get recommended\");\n\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[12, 19]]);\n    }));\n\n    return function fetchAllRecommendations() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var renderRecommendedModules = function renderRecommendedModules() {\n    if (userId) {\n      if (recommendedModules.length > 0) {\n        console.log(\"Recommended:\", recommendedModules);\n        return __jsx(React.Fragment, null, __jsx(SectionTitle, {\n          title: \"Recommended For You\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 13\n          }\n        }), __jsx(HomeModuleList, {\n          modules: recommendedModules,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 56,\n            columnNumber: 13\n          }\n        }));\n      } else {\n        return __jsx(React.Fragment, null, __jsx(SectionTitle, {\n          title: \"Recommended For You\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 62,\n            columnNumber: 13\n          }\n        }), __jsx(\"p\", {\n          style: {\n            textAlign: \"center\",\n            paddingTop: \"20px\"\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 63,\n            columnNumber: 13\n          }\n        }, \"Sorry we do not have enough information about you to recommend modules for you!\"));\n      }\n    }\n  };\n\n  return __jsx(React.Fragment, null, __jsx(ModuleCompareModal, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }\n  }), __jsx(SectionTitle, {\n    title: \"Trending Modules\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }\n  }), __jsx(HomeModuleList, {\n    modules: trendingModules,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }\n  }), __jsx(SectionTitle, {\n    title: \"Popular Modules\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }\n  }), __jsx(HomeModuleList, {\n    modules: popularModules,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }\n  }), isLoggedIn && renderRecommendedModules());\n};\n\n_s(Home, \"StlPpzqT7HrJNURzMuVCVl+tjfU=\", false, function () {\n  return [useSelector, useSelector];\n});\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/Users/ChesterSim/Desktop/NUS Computer Science/CS3219/cs3219-ay2021-s1-project-2020-s1-g01/frontend/pages/home.tsx"],"names":["HomeModuleList","SectionTitle","ModuleCompareModal","useSelector","recommendationApi","moduleApi","useEffect","useState","Home","isLoggedIn","state","auth","userId","user","_id","trendingModules","setTrendingModules","popularModules","setPopularModules","recommendedModules","setRecommendedModules","fetchAllRecommendations","searchModule","backupModules","concatBackup","modulesToRecommend","setModulesMethod","length","concat","getMostRatedModules","mostRatedModules","mods","getMostViewedModules","mostViewedModules","getRecommendedModules","console","log","renderRecommendedModules","textAlign","paddingTop"],"mappings":"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","sourcesContent":["import { NextPage } from \"next\";\n\nimport HomeModuleList from \"../components/HomeModuleList\";\nimport SectionTitle from \"../components/SectionTitle\";\nimport ModuleCompareModal from \"../components/ModuleCompareModal\";\nimport { useSelector } from \"react-redux\";\nimport recommendationApi from \"../api/recommendations\";\nimport moduleApi from \"../api/module\";\n\nimport { useEffect, useState } from \"react\";\n\nconst Home: NextPage = ({}) => {\n  const isLoggedIn = useSelector((state) => state.auth.isLoggedIn);\n  const userId = useSelector((state) => state.auth.user?._id);\n\n  const [trendingModules, setTrendingModules] = useState([]);\n  const [popularModules, setPopularModules] = useState([]);\n  const [recommendedModules, setRecommendedModules] = useState([]);\n\n  useEffect(() => {\n    fetchAllRecommendations();\n  }, [userId]);\n\n  const fetchAllRecommendations = async () => {\n    const backupModules = await moduleApi.searchModule(\"\");\n\n    const concatBackup = (modulesToRecommend, setModulesMethod) => {\n      if (modulesToRecommend.length < 3) {\n        modulesToRecommend.concat(backupModules);\n      }\n      \n    }\n\n    const mostRatedModules = await recommendationApi.getMostRatedModules();\n    setPopularModules(mostRatedModules.mods);\n    const mostViewedModules = await recommendationApi.getMostViewedModules();\n    setTrendingModules(mostViewedModules.mods);\n\n    try {\n      const recommendedModules = await recommendationApi.getRecommendedModules(\n        userId\n      );\n      setRecommendedModules(recommendedModules.mods);\n    } catch (err) {\n      console.log(\"User has insufficient activities to get recommended\");\n    }\n  };\n\n  const renderRecommendedModules = () => {\n    if (userId) {\n      if (recommendedModules.length > 0) {\n        console.log(\"Recommended:\", recommendedModules);\n        return (\n          <>\n            <SectionTitle title=\"Recommended For You\" />\n            <HomeModuleList modules={recommendedModules} />\n          </>\n        );\n      } else {\n        return (\n          <>\n            <SectionTitle title=\"Recommended For You\" />\n            <p style={{ textAlign: \"center\", paddingTop: \"20px\" }}>\n              Sorry we do not have enough information about you to recommend\n              modules for you!\n            </p>\n          </>\n        );\n      }\n    }\n  };\n\n  return (\n    <>\n      <ModuleCompareModal />\n      <SectionTitle title=\"Trending Modules\" />\n      <HomeModuleList modules={trendingModules} />\n      <SectionTitle title=\"Popular Modules\" />\n      <HomeModuleList modules={popularModules} />\n      {isLoggedIn && renderRecommendedModules()}\n    </>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}